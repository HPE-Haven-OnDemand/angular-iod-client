"use strict";function ReqBodyData(a){var b=this;b.params={},_.map(a,function(a,c){void 0!=a&&(b.params[c]=a)})}function ReqQueryParams(a){var b=this;b.params={},_.map(a,function(a,c){void 0!=a&&(b.params[c]=a)})}function IodConnectorService(a,b){function c(b,c,d,e,f,g){var h="createconnector/v1",i=void 0!==f?f:{};switch(b){case l.WEB:case l.SHAREPOINT:i.url=d;break;case l.FS:i.directoryPathCSVs=d}var j=i,k={action:m.ADD_TO_INDEX,index:e},n=new ReqBodyData;return n.append({connector:c}),n.append({config:j}),n.append({flavor:b}),n.append({destination:k}),g&&n.append(n.append({destination:k})),a.doApiPost(h,n)}function d(c){b.debug("deleting connector {0}",[c]);var d="deleteconnector/v1",e=new ReqQueryParams({connector:c});return a.doApiGet(d,e)}function e(c,d){b.debug("retrieveConfig {0}",[c]);var e=new ReqQueryParams;e.append({connector:c}),e.append({output:"config_attributes"}),e.append(d);var f="retrieveconfig/v1";return a.doApiGet(f,e)}function f(c,d){b.debug("connectorStatus {0}",[c]);var e="connectorstatus/v1",f=new ReqQueryParams;return f.append({connector:c}),f.append(d),a.doApiGet(e,f)}function g(b,c,d,e){var f="updateconnector/v1",g=new ReqBodyData;if(g.append({connector:b}),null!==c&&void 0!==c&&g.append({config:c}),void 0!=d){var h={action:m.ADD_TO_INDEX,index:d};g.append({destination:h})}return e&&g.append(e),a.doApiPost(f,g)}function h(b,c){var d="/startconnector/v1",e=new ReqBodyData;return e.append({connector:b}),c&&e.append(c),a.doApiPost(d,e)}function i(b){var c="/stopconnector/v1",d=new ReqBodyData;return d.append({connector:b}),a.doApiPost(c,d)}function j(b){var c="cancelconnectorschedule/v1",d=new ReqBodyData;return d.append({connector:b}),a.doApiPost(c,d)}function k(b){var c="connectorhistory/v1",d=new ReqQueryParams;return b&&d.append(b),a.doApiGet(c,d)}var l={WEB:"web_cloud",FS:"filesystem_onsite",SHAREPOINT:"remote_sharepoint_onsite",DROPBOX:"dropbox_cloud"},m={ADD_TO_INDEX:"addtotextindex"},n={createConnector:c,deleteConnector:d,updateConnector:g,startConnector:h,stopConnector:i,connectorStatus:f,retrieveConfig:e,cancelConnectorSchedule:j,connectorHistory:k};return n}function IodIndexService(a,b,c){function d(a,b,d,e,f,g){var h="textindex/"+encodeURIComponent(a)+"/v1",i=new ReqBodyData;return i.append({flavor:b,description:d,index_fields:e,parametric_fields:f,expiretime:g}),c.doApiPost(h,i)}function e(d){var e=b.defer(),g="textindex/"+encodeURIComponent(d)+"/v1";return c.doApiDelete(g).success(function(b){var c=b.confirm;a.debug("confirming deleting text index {0}",[d]),f(d,c).success(function(b){a.debug("Index {0} deleted ",[d]),e.resolve(b)}).error(function(b){a.debug("Failed to delete Index {0}",[d]),e.reject(b)})}).error(function(b){a.debug("Failed to receive delete confirmation code for Index {0} ",[d]),e.reject(b)}),e.promise}function f(a,b){var d=new ReqQueryParams;d.append({confirm:b});var e="textindex/"+encodeURIComponent(a)+"/v1";return c.doApiDelete(e,d,null)}function g(){}function h(a,d,e){var f=b.defer();try{var g=new FormData;if(g.append("file",d),!a||!_.isString(a))throw new Error("Expected indexName to be defined and a String");var h="textindex/"+encodeURIComponent(a)+"/document/v1",i=_.extend(e,{transformRequest:angular.identity,headers:{"Content-Type":void 0}});c.doApiPostWithoutDataValidation(h,g,null,i).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)})}catch(j){f.reject(j)}return f.promise}function i(){}function j(a){var b="textindex/"+encodeURIComponent(a)+"/status/v1";return c.doApiGet(b)}function k(){var a=new ReqQueryParams;return a.append({type:m.INDEX_TYPES.INDEX}),a.append({flavor:m.INDEX_FLAVORS.STANDARD}),c.doApiGet("resource/v1",a)}function l(){return c.doApiGet("resource/v1")}a=a.getInstance("IodIndexService");var m={INDEX_FLAVORS:{SMALL:"explorer",STANDARD:"standard",CATEGORIZATION:"categorization"},INDEX_TYPES:{INDEX:"content",CONNECTOR:"connector"}},n={createIndex:d,deleteIndex:e,restoreIndex:g,addToTextIndex:h,deleteFromTextIndex:i,indexStatus:j,retrieveIndexesList:k,retrieveResourcesList:l};return n}function IodQueryProfileService(a,b){function c(a,c,d){var e="queryprofile/"+encodeURIComponent(a)+"/v1",f={query_manipulation_index:c,promotions_enabled:!0,promotion_categories:d,promotions_identified:!0,synonyms_enabled:!0,synonym_categories:d,blacklists_enabled:!0,blacklist_categories:d},g=new ReqBodyData;return g.append(f),b.doApiPost(e,g)}function d(a){var c="queryprofile/"+encodeURIComponent(a)+"/v1",d=new ReqBodyData;return b.doApiDelete(c,d)}function e(a){var c="queryprofile/"+encodeURIComponent(a)+"/v1",d=new ReqBodyData;return b.doApiPut(c,d)}function f(a){var c="queryprofile/"+encodeURIComponent(a)+"/v1";return b.doApiGet(c)}a=a.getInstance("IodQueryProfileService");var g={createQueryProfile:c,deleteQueryProfile:d,updateQueryProfile:e,retrieveQueryProfile:f};return g}function IodSearchService(a,b,c){function d(a,b,d,e,f){var g=new ReqQueryParams;if(g.append({text:a}),g.append({maxPageResults:j.MAX_PAGE_RESULTS}),g.append({total_results:!0}),g.append({summary:"context"}),g.append({highlight:"terms"}),g.append({start_tag:'<span class="highlightedTerm" ">'}),b){var h=b*j.MAX_PAGE_RESULTS+1;g.append({start:h}),g.append({absolute_max_results:j.ABSOLUTE_MAX_RESULTS+h})}else g.append({start:1}),g.append({absolute_max_results:j.ABSOLUTE_MAX_RESULTS});return d&&g.append({index:d}),e&&g.append({sort:e}),f&&g.append({min_date:f}),c.doApiGet("querytextindex/v1",g)}function e(a){var b=new ReqQueryParams;return b.append({index:a}),b.append({group_fields_by_type:!0}),c.doApiGet("textindex/query/fields/v1",b)}function f(a,b){var d=new ReqQueryParams;return d.append({text:a}),b&&d.append({indexes:b}),c.doApiGet("findrelatedconcepts/v1",d)}function g(a,b){return 0==a.length?!1:null==b?!1:!0}function h(){return c.doApiGet("queryprofile/v1")}function i(){return j.MAX_PAGE_RESULTS}var j={MAX_PAGE_RESULTS:10,ABSOLUTE_MAX_RESULTS:20},k={queryTextIndex:d,retrieveIndexFields:e,findRelatedConcepts:f,isQueryPhraseValid:g,listQueryProfiles:h,getQueryResultsPageSize:i};return k}function IodDiscoveryService(a,b){function c(a){var c=new ReqQueryParams;return a&&c.append({flavors:a}),b.doDiscoveryGet("downloadLinks",c)}var d={getConnectorAgentDownloadLinks:c};return d}function IodEnvConfigService(a){function b(){return g}function c(){return h}function d(a){return a&&angular.isString(a)&&(i=a),i}function e(){return i}function f(){return k}var g,h,i,j={PROTOCOL:"https",DOMAIN:"havenondemand.com",PORT:void 0,API_DOMAIN_PREFIX:"api",PLATFORM_VERSION:"1"},k=!0;try{g=[j.PROTOCOL,"://",j.API_DOMAIN_PREFIX,".",j.DOMAIN,j.PORT?":"+j.PORT:""].join(""),h=[j.PROTOCOL,"://",j.DOMAIN,j.PORT?":"+j.PORT:""].join("")}catch(l){g="",h="",a.error("Configuration error! one of the IOD configuration attributes is missing"),k=!1}var m={getIodHost:b,getIodPortal:c,setApiKey:d,getApiKey:e,isEnvConfigValid:f};return m}function IodHttpService(a,b,c){function d(a,c){var d,e=r(a);return d=c instanceof ReqQueryParams?c:new ReqQueryParams(c),o(d),b.debug("calling INFO get to "+e),k(e,d)}function e(a,c){var d,e=s(a);return d=c instanceof ReqQueryParams?c:new ReqQueryParams(c),o(d),b.debug("calling DISCOVERY get to "+e),k(e,d)}function f(a,c,d,e){var f,g=q(a,e);return f=c instanceof ReqQueryParams?c:new ReqQueryParams(c),o(f),b.debug("calling API get to "+g+", with :"+d),k(g,f).then(function(a){return a.data})}function g(a,c,d,e){var f,g=q(a,e);return f=d instanceof ReqQueryParams?d:new ReqQueryParams(d),o(f),b.debug("calling API POST to "+g),l(g,c,f).then(function(a){return a.data})}function h(c,d,e,f,g){var h,i;d=d||{},f=f||{},h=e instanceof ReqQueryParams?e:new ReqQueryParams(e),o(h),i=[p(),q(c,g)].join(""),b.debug("performing a POST request to "+i);var j=_.extend({method:"POST",url:i,params:h.params,data:d,transformRequest:angular.identity,headers:{"Content-Type":void 0}},f);return a(j).then(function(a){return a.data})}function i(a,c,d,e){var f,g=q(a,e);return f=d instanceof ReqQueryParams?d:new ReqQueryParams(d),o(f),b.debug("calling API PUT to "+g),m(g,f,c).then(function(a){return a.data})}function j(a,c,d,e){var f,g=q(a,e);return f=c instanceof ReqQueryParams?c:new ReqQueryParams(c),o(f),b.debug("calling API PUT to "+g),n(g,f,d).then(function(a){return a.data})}function k(c,d){var e,f,g=p();return e=g+c,f=d instanceof ReqQueryParams?d:new ReqQueryParams(d),b.debug("performing a GET request to "+e),a({method:"GET",url:e,params:f.params})}function l(c,d,e){var f,g,h,i=p();return f=i+c,g=e instanceof ReqQueryParams?e:new ReqQueryParams(e),h=d instanceof ReqBodyData?d:new ReqBodyData(d),b.debug("performing a POST request to "+f),a({method:"POST",url:f,params:g.params,data:$.param(h.getSerializeParamaters()),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function m(c,d,e){var f,g,h,i=p();return f=i+c,g=d instanceof ReqQueryParams?d:new ReqQueryParams(d),h=e instanceof ReqBodyData?e:new ReqBodyData(e),b.debug("preforming a PUT request to "+f),a({method:"PUT",url:f,params:g.params,data:$.param(h.getSerializeParamaters()),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return a.data})}function n(c,d,e){var f,g,h,i=p();return f=i+c,g=d instanceof ReqQueryParams?d:new ReqQueryParams(d),h=e instanceof ReqBodyData?e:new ReqBodyData(e),b.debug("preforming a DELETE request to "+f),a({method:"DELETE",url:f,params:g.params,data:$.param(h.getSerializeParamaters()),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function o(a){a.append({apiKey:c.getApiKey()})}function p(){return c.getIodHost()+"/"+u+"/"}function q(a,b){return b=b||!1,[v.API,b?x:w,a].join("/")}function r(a){return[v.INFO,a].join("/")}function s(a){return[v.DISCOVERY,a].join("/")}var t=this;t.sessionToken=null;var u=1,v={API:"api",INFO:"info",DISCOVERY:"discovery"},w="sync",x="async",y={doApiGet:f,doApiPost:g,doApiPostWithoutDataValidation:h,doApiPut:i,doApiDelete:j,doInfoGet:d,doDiscoveryGet:e};return y}function IodInfoService(a,b){function c(){return b.doInfoGet("quota/project/")}function d(){return b.doInfoGet("quota/indexflavors/")}a=a.getInstance("IodInfoService");var e={getProjectQuotas:c,getIndexFlavorsQuota:d};return e}function IodStatisticsService(a,b){function c(){return b.doApiGet("application/user/v1")}function d(c){var d=new ReqQueryParams;return d.append({indexes:c}),d.append({field_name:"content_type"}),d.append({document_count:!0}),a.debug("Calling getIndexDocTypesCount"),b.doApiGet("textindex/query/parametricvalues/v1",d)}a=a.getInstance("IodStatisticsService");var e={getApplicationUsers:c,getIndexDocTypesCount:d};return e}angular.module("iod-client",[]).config(["$httpProvider",function(a){a.defaults.withCredentials=!0}]),ReqBodyData.prototype.append=function(a){var b=this;_.map(a,function(a,c){void 0!=a&&(b.params[c]=a)})},ReqBodyData.prototype.getSerializeParamaters=function(){var a=this,b={};return _.map(a.params,function(a,c){_.isObject(a)&&!_.isArray(a)?b[c]=JSON.stringify(a):b[c]=a}),b},ReqQueryParams.prototype.append=function(a){var b=this;_.map(a,function(a,c){void 0!=a&&(void 0===b.params[c]?b.params[c]=a:_.isArray(b.params[c])?b.params[c].push(a):b.params[c]=[b.params[c],a])})},ReqQueryParams.prototype.remove=function(a){var b=this;b.params[a]&&delete b.params[a]},angular.module("iod-client").factory("iodConnectorService",IodConnectorService),IodConnectorService.$inject=["iodHttpService","$log"],angular.module("iod-client").factory("iodIndexService",IodIndexService),IodIndexService.$inject=["$log","$q","iodHttpService"],angular.module("iod-client").factory("iodQueryProfileService",IodQueryProfileService),IodQueryProfileService.$inject=["$log","iodHttpService"],angular.module("iod-client").factory("iodSearchService",IodSearchService),IodSearchService.$inject=["$log","$q","iodHttpService"],angular.module("iod-client").factory("iodDiscoveryService",IodDiscoveryService),IodDiscoveryService.$inject=["$log","iodHttpService"],angular.module("iod-client").factory("iodEnvConfigService",IodEnvConfigService),IodEnvConfigService.$inject=["$log"],angular.module("iod-client").factory("iodHttpService",IodHttpService),IodHttpService.$inject=["$http","$log","iodEnvConfigService"],angular.module("iod-client").factory("iodInfoService",IodInfoService),IodInfoService.$inject=["$log","iodHttpService"],angular.module("iod-client").factory("iodStatisticsService",IodStatisticsService),IodStatisticsService.$inject=["$log","iodHttpService"];